"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[351],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>f});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=n.createContext({}),s=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},u=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(r),c=a,f=d["".concat(p,".").concat(c)]||d[c]||m[c]||i;return r?n.createElement(f,l(l({ref:t},u),{},{components:r})):n.createElement(f,l({ref:t},u))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,l=new Array(i);l[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[d]="string"==typeof e?e:a,l[1]=o;for(var s=2;s<i;s++)l[s]=r[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},62561:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var n=r(87462),a=(r(67294),r(3905));const i={layout:"default",title:"App Utils Module",parent:"Core",grand_parent:"Libraries",nav_order:1},l="App Utils Module",o={unversionedId:"libraries/core/app-utils",id:"libraries/core/app-utils",title:"App Utils Module",description:"Overview",source:"@site/docs/libraries/core/app-utils.md",sourceDirName:"libraries/core",slug:"/libraries/core/app-utils",permalink:"/dokku/docs/libraries/core/app-utils",draft:!1,editUrl:"https://github.com/hebus/dokku/tree/main/docs/libraries/core/app-utils.md",tags:[],version:"current",frontMatter:{layout:"default",title:"App Utils Module",parent:"Core",grand_parent:"Libraries",nav_order:1},sidebar:"tutorialSidebar",previous:{title:"Core",permalink:"/dokku/docs/libraries/core/"},next:{title:"Intl Module",permalink:"/dokku/docs/libraries/core/intl"}},p={},s=[{value:"Overview",id:"overview",level:2},{value:"AppService",id:"appservice",level:2},{value:"Query",id:"query",level:2},{value:"Creation",id:"creation",level:3},{value:"Searching for text",id:"searching-for-text",level:3},{value:"Selecting a tab or scope",id:"selecting-a-tab-or-scope",level:3},{value:"Filtering the metadata",id:"filtering-the-metadata",level:3},{value:"Sorting the results",id:"sorting-the-results",level:3},{value:"Paging",id:"paging",level:3},{value:"Other properties",id:"other-properties",level:3},{value:"Format Service",id:"format-service",level:2}],u={toc:s},d="wrapper";function m(e){let{components:t,...r}=e;return(0,a.kt)(d,(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"app-utils-module"},"App Utils Module"),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"The App Utils module contains utilities for working with the configuration of a Sinequa SBA. It can be used by simply importing the module."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { AppUtilsModule } from '@sinequa/core/app-utils';\n...\n@NgModule({\n    imports: [\n        ...\n        AppUtilsModule\n    ]\n}}\n")),(0,a.kt)("h2",{id:"appservice"},"AppService"),(0,a.kt)("p",null,"This service includes an ",(0,a.kt)("inlineCode",{parentName:"p"},"init")," method which is called automatically by ",(0,a.kt)("inlineCode",{parentName:"p"},"LoginService.login")," and loads the app configuration using\n",(0,a.kt)("inlineCode",{parentName:"p"},"AppWebService.get"),". It maintains the currently active ",(0,a.kt)("inlineCode",{parentName:"p"},"ccquery")," which can be used by higher level services and components. Each time\n",(0,a.kt)("inlineCode",{parentName:"p"},"ccquery")," changes a ",(0,a.kt)("inlineCode",{parentName:"p"},"QueryChangedEvent")," is emitted by the service."),(0,a.kt)("p",null,"The service provides facilities for working with various Sinequa configuration elements linked to an application:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"web services"),(0,a.kt)("li",{parentName:"ul"},"lists"),(0,a.kt)("li",{parentName:"ul"},"index columns and their aliases")),(0,a.kt)("h2",{id:"query"},"Query"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Query")," object is the main input of the query web service (see ",(0,a.kt)("a",{parentName:"p",href:"/dokku/docs/libraries/core/web-services#query-web-service"},"web services")," and ",(0,a.kt)("a",{parentName:"p",href:"/dokku/docs/guides/server-config#web-services"},"server configuration"),"). It specifies the search query and its parameters."),(0,a.kt)("h3",{id:"creation"},"Creation"),(0,a.kt)("p",null,"A ",(0,a.kt)("inlineCode",{parentName:"p"},"Query")," is created with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'const query = new Query("<name of the query web service>");\n')),(0,a.kt)("h3",{id:"searching-for-text"},"Searching for text"),(0,a.kt)("p",null,"Specifying the fulltext query is done with the ",(0,a.kt)("inlineCode",{parentName:"p"},"text")," property:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'query.text = "my search query";\n')),(0,a.kt)("h3",{id:"selecting-a-tab-or-scope"},"Selecting a tab or scope"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"tab")," property is used to select a tab:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'query.tab = "tab name";\n')),(0,a.kt)("p",null,"Similarly, the ",(0,a.kt)("inlineCode",{parentName:"p"},"scope")," property is used to select a scope:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'query.scope = "scope name";\n')),(0,a.kt)("h3",{id:"filtering-the-metadata"},"Filtering the metadata"),(0,a.kt)("p",null,'A "filter" is a condition applied on the metadata of the documents. For example, a filter could be "the document\'s source is \'Documentation\'":'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'query.addFilter({\n  field: "source",\n  value: "Documentation"\n});\n')),(0,a.kt)("p",null,"There are different types of filters, that roughly correspond to the SQL operators supported by the Sinequa engine:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Equals: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "source", value: "Documentation"}')," (the ",(0,a.kt)("inlineCode",{parentName:"li"},"eq")," operator is implicit)"),(0,a.kt)("li",{parentName:"ul"},"Not equals: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "source", value: "Documentation", operator: "neq"}')),(0,a.kt)("li",{parentName:"ul"},"Greater than: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "size", value: 1000, operator: "gt"}')),(0,a.kt)("li",{parentName:"ul"},"Greater than or equals: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "size", value: 1000, operator: "gte"}')),(0,a.kt)("li",{parentName:"ul"},"Less than: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "size", value: 1000, operator: "lt"}')),(0,a.kt)("li",{parentName:"ul"},"Less than or equals: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "size", value: 1000, operator: "lte"}')),(0,a.kt)("li",{parentName:"ul"},"Between: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "size", start: 1000, end: 2000, operator: "between"}')),(0,a.kt)("li",{parentName:"ul"},"Like: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "title", value: "Sinequa", operator: "like"}')),(0,a.kt)("li",{parentName:"ul"},"Contains: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "authors", value: "John", operator: "contains"}')),(0,a.kt)("li",{parentName:"ul"},"Regex: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "format", value: "doc[xm]?", operator: "regex"}')),(0,a.kt)("li",{parentName:"ul"},"In: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "format", values: ["pdf", "doc", "docx"], operator: "in"}')),(0,a.kt)("li",{parentName:"ul"},"Null: ",(0,a.kt)("inlineCode",{parentName:"li"},'{field: "msgto", operator: "null", not: true}'))),(0,a.kt)("p",null,"Additionally, the ",(0,a.kt)("inlineCode",{parentName:"p"},"operator")," property can be set to ",(0,a.kt)("inlineCode",{parentName:"p"},'"and"'),", ",(0,a.kt)("inlineCode",{parentName:"p"},'"or"')," or ",(0,a.kt)("inlineCode",{parentName:"p"},'"not"')," to combine multiple filters:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'query.addFilter({\n  operator: "and",\n  filters: [\n    {field: "treepath", value: "/Documentation/Sinequa/"},\n    {\n      operator: "or",\n      filters: [\n        {field: "docformat", value: "pdf"},\n        {field: "docformat", value: "html"},\n      ]\n    }\n  ]\n});\n')),(0,a.kt)("p",null,"It is also possible to specify a ",(0,a.kt)("inlineCode",{parentName:"p"},"display")," property to customize the display of the filter in the UI:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'query.addFilter({\n  field: "treepath",\n  value: "/Documentation/Sinequa/",\n  display: "Sinequa"\n});\n')),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Query")," has various helper methods to manage the filters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"addFilter"),": Adds a filter to the query.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"findFilter"),": Return the first filter in the filter tree that matches the given predicate."),(0,a.kt)("p",{parentName:"li"},'For example, find all filters on the "source" field:'),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'query.findFilter(f => isFieldFilter(f) && f.field === "source");\n'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"findAllFilters"),": Return all filters in the filter tree that match the given predicate.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"findFieldFilters"),": Return all filters in the filter tree that are field filters (with a ",(0,a.kt)("inlineCode",{parentName:"p"},"field")," property, as opposed to ",(0,a.kt)("inlineCode",{parentName:"p"},"and"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"or"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"not")," filters) and that match the given field(s).")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"findValueFilters"),": Return all filters in the filter tree that are value filters (with a ",(0,a.kt)("inlineCode",{parentName:"p"},"value")," property, as opposed to ",(0,a.kt)("inlineCode",{parentName:"p"},"and"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"or"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"not"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"in"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"between"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"null")," filters) and that match the given field(s).")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"findSameFilter"),": Return the first filter in the filter tree that is equivalent to the given filter.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"forEachFilter"),": Execute a function on each filter in the filter tree.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"getFilterCount"),": Return the number of filters in the filter tree.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"removeFilters"),": Remove all filters in the filter tree that match the given predicate.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"removeSameFilter"),": Remove the first filter in the filter tree that is equivalent to the given filter.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"removeFieldFilters"),": Remove all filters in the filter tree that are field filters (with a ",(0,a.kt)("inlineCode",{parentName:"p"},"field")," property, as opposed to ",(0,a.kt)("inlineCode",{parentName:"p"},"and"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"or"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"not")," filters) and that match the given field(s)."))),(0,a.kt)("h3",{id:"sorting-the-results"},"Sorting the results"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"sort"),' property is used to sort the results. It must be configured in the query web service. For example, if the query web service has a sort named "date", then:'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'query.sort = "date";\n')),(0,a.kt)("h3",{id:"paging"},"Paging"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"page")," property is used to specify the page of results to fetch:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"query.page = 2;\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"pageSize")," property is used to specify the number of results per page:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"query.pageSize = 20;\n")),(0,a.kt)("h3",{id:"other-properties"},"Other properties"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Query")," object has other less frequently used properties that can be configured. See the source code for more details."),(0,a.kt)("h2",{id:"format-service"},"Format Service"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"FormatService")," is used to format values retrieved from a Sinequa index according to their type and the current locale.\nNumbers, dates and booleans are all handled by default. Custom formatters can also be assigned to columns in the Sinequa\nadministration. The ",(0,a.kt)("inlineCode",{parentName:"p"},"memorysize")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"language")," formatters are provided by default. The strings used in these formatters\nare defined in the messages in the ",(0,a.kt)("a",{parentName:"p",href:"/dokku/docs/libraries/core/intl"},"Intl Module"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// The following will display \"size: 2.92Kb\" when using the en locale\nlet column = this.appService.getColumn('size');\n// Note that this would normally be configured in the Sinequa administration\ncolumn.formatter = 'memorysize';\nconsole.log('size:', this.formatService.format(3000, column));\n// The following will display \"language: French\" when using the en locale\ncolumn = this.appService.getColumn('documentlanguages');\n// Note that this would normally be configured in the Sinequa administration\ncolumn.formatter = 'language';\nconsole.log('language:', this.formatService.format('fr', column));\n")),(0,a.kt)("p",null,"Custom formatters can be provided by overriding the ",(0,a.kt)("inlineCode",{parentName:"p"},"FormatService")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { Injectable } from '@angular/core/';\nimport { FormatService, ValueItem } from '@sinequa/core/app-utils';\nimport { FieldValue } from '@sinequa/core/base';\nimport { CCColumn } from '@sinequa/core/web-services';\n...\n@Injectable({\n    providedIn: 'root'\n})\nexport class MyFormatService extends FormatService {\n    // Add support for a custom formatter\n    formatValue: (valueItem: ValueItem | FieldValue, column?: CCColumn): string {\n        if (column && column.formatter === 'mycustomformatter') {\n            let [value, display] = this.getValueAndDisplay(valueItem);\n            switch (value) {\n                case 0:\n                    return \"zero\";\n                case 1:\n                    return \"one\";\n                case 2:\n                    return \"two\";\n            }\n        }\n        return super.formatValue(valueItem, column);\n    }\n};\n...\n// Provide\n@NgModule({\n    providers: [\n        { provider: FormatService, useClass: MyFormatService }\n    ]\n})\n")),(0,a.kt)("p",null,"Similarly, parsers can also be specified. These are used to parse values in fielded search expressions. A ",(0,a.kt)("inlineCode",{parentName:"p"},"memorysize")," parser is included\nby default so that fielded search expressions such as ",(0,a.kt)("inlineCode",{parentName:"p"},"size:>=25Kb")," can be used. Note that server-side support for custom parsers is also\nrequired so that the expressions can be parsed on the server. A server-side custom parser takes the form of a function plugin named\n",(0,a.kt)("inlineCode",{parentName:"p"},"ParseExpressionValue")," which takes the custom parser name and the value to be parsed as parameters:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},'public class ParseExpressionValue : FunctionPlugin\n{\n    public override string GetValue(IDocContext ctxt, params string[] values)\n    {\n        if (values.Length <= 1) return null;\n        var parser = values[0];\n        var value = values[1];\n        if (parser == "mycustomparser")\n        {\n            // return the parsed value here\n        }\n        return null;\n    }\n}\n')))}m.isMDXComponent=!0}}]);