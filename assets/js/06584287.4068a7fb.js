"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6947],{84585:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});var l=s(74848),a=s(28453);const t={layout:"default",title:"Intl Module",parent:"Core",grand_parent:"Libraries",nav_order:2},o="Intl Module",i={id:"libraries/core/intl",title:"Intl Module",description:"Overview",source:"@site/docs/libraries/core/intl.md",sourceDirName:"libraries/core",slug:"/libraries/core/intl",permalink:"/dokku/docs/libraries/core/intl",draft:!1,unlisted:!1,editUrl:"https://github.com/sinequa/sba-angular/tree/main/docs/libraries/core/intl.md",tags:[],version:"current",frontMatter:{layout:"default",title:"Intl Module",parent:"Core",grand_parent:"Libraries",nav_order:2},sidebar:"tutorialSidebar",previous:{title:"App Utils Module",permalink:"/dokku/docs/libraries/core/app-utils"},next:{title:"Login Module",permalink:"/dokku/docs/libraries/core/login"}},r={},c=[{value:"Overview",id:"overview",level:2},{value:"Registering locales",id:"registering-locales",level:2},{value:"Locale files",id:"locale-files",level:2},{value:"Current locale",id:"current-locale",level:2},{value:"Messages",id:"messages",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"intl-module",children:"Intl Module"}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.p,{children:["This module provides internationalization (i18n) support to an application. Core functionality is provided by the ",(0,l.jsx)(n.code,{children:"IntlService"}),"\nwhich manages locales and formats dates, numbers and strings depending on the current locale. It is based on the standard\n",(0,l.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl",children:"Intl"})," API and an implementation of the\nICU Message syntax provided by ",(0,l.jsx)(n.a,{href:"https://formatjs.io/",children:"FormatJS"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"registering-locales",children:"Registering locales"}),"\n",(0,l.jsxs)(n.p,{children:["A Sinequa locale defines the ",(0,l.jsx)(n.code,{children:"name"})," and ",(0,l.jsx)(n.code,{children:"display"})," and the ",(0,l.jsx)(n.code,{children:"data"})," associated with the locale. At a minimum the ",(0,l.jsx)(n.code,{children:"data"})," will define\nthe locale for the ",(0,l.jsx)(n.code,{children:"Intl"})," library and the messages in the locale's language. Locale data for additional 3rd party libaries\n(eg D3.js, Moment.js) can also be included. The supported locales for an application are defined by passing a class derived from\n",(0,l.jsx)(n.code,{children:"LocalesConfig"})," to the ",(0,l.jsx)(n.code,{children:"IntlModule.forRoot"})," static method when importing the ",(0,l.jsx)(n.code,{children:"IntlNodule"})," in your application's ",(0,l.jsx)(n.code,{children:"NgModule"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:'import { LocalesConfig, Locale } from "@sinequa/core/intl";\nimport enLocale from "../locales/en";\n...\nexport class AppLocalesConfig implements LocalesConfig {\n    defaultLocale: Locale;\n    locales?: Locale[];\n    constructor() {\n        this.locales = [\n            { name: "en", display: "msg#locale.en", data: enLocale},\n            { name: "fr", display: "msg#locale.fr", data: frLocale},\n            { name: "de", display: "msg#locale.de", data: deLocale},\n        ]\n        this.defaultLocale = this.locales[0];\n    }\n}\n...\n@NgModule({\n    imports: [\n        ...\n        IntlModule.forRoot(AppLocalesConfig),\n    ]\n})\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Alternatively, the ",(0,l.jsx)(n.code,{children:"Core"})," library includes a default (en-US) locale that can be used to quickly get started:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"import { DefaultLocalesConfig } from '@sinequa/core';\n...\n@NgModule({\n    imports: [\n        ...\n        IntlModule.forRoot(DefaultLocalesConfig),\n    ]\n})\n"})}),"\n",(0,l.jsx)(n.h2,{id:"locale-files",children:"Locale files"}),"\n",(0,l.jsx)(n.p,{children:"The data for a locale is typically defined in its own file and follows the following structure:"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"./locales/de.ts"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"import { LocaleData } from '@sinequa/core/intl';\nimport 'intl/locale-data/jsonp/de-DE'; // Safari\nimport '@formatjs/intl-relativetimeformat/dist/locale-data/de'; // relative time format support\nimport 'moment/locale/de'; // Moment.js\nimport d3Format from 'd3-format/locale/en-US.json'; // D3.js\nimport d3Time from 'd3-time-format/locale/en-US.json'; // D3.js\nimport { enCore } from '@sinequa/core'; // Core language files\n// Load language files for those components used...\nimport { deAdvanced } from '@sinequa/components/advanced';\n...\nimport appMessages from './messages/en.json';\nimport { Utils } from '@sinequa/core/base';\n\n// Merge the messages\nconst messages = Utils.merge({}, deCore, deAdvanced, ..., appMessages);\n\n// Export the LocaleData\nexport default {\n    intl: {\n        locale: 'de-DE'\n    },\n    moment: {\n        locale: 'de'\n    },\n    d3: {\n        locale: 'de-DE',\n        format: d3Format,\n        time: d3Time\n    },\n    messages: messages\n} as LocaleData;\n\n"})}),"\n",(0,l.jsx)(n.h2,{id:"current-locale",children:"Current locale"}),"\n",(0,l.jsx)(n.p,{children:"The current locale is initialized at application startup. It is set in this order:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"the previously selected locale retrieved from local storage (key = 'sinequa-locale')"}),"\n",(0,l.jsx)(n.li,{children:"a locale matching the browser language"}),"\n",(0,l.jsxs)(n.li,{children:["the deafault locale as specified in ",(0,l.jsx)(n.code,{children:"LocalesConfig"})]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"IntlService"})," can change the current locale to one of the values in the\nconfigured ",(0,l.jsx)(n.code,{children:"LocalesConfig"}),". By default, the passed value will be persistent (stored in\nlocal storage)."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"this.intlService.use('fr');\n"})}),"\n",(0,l.jsx)(n.p,{children:"Each time the locale is changed an event is raised which can be subscribed to like this:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"this.intlService.events.subscribe(\n    (event) => {\n        console.log('new locale selected:', event.locale);\n    }\n);\n"})}),"\n",(0,l.jsx)(n.h2,{id:"messages",children:"Messages"}),"\n",(0,l.jsxs)(n.p,{children:["Messages defined in locale message files can be accessed by ",(0,l.jsx)(n.code,{children:"IntlService.formatMessage"}),".\nThe keys must be prefixed by ",(0,l.jsx)(n.code,{children:"msg#"})," and the remainder of the key is then a simple JSON path\nlookup into the messages object for the current locale. So, for a messages object with the\nfollowing structure:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n    "sectionOne": {\n        "greeting1": "This is greeting one",\n        "greeting2": "This is greeting two"\n    },\n    "sectionTwo": {\n        "greeting1": "This is greeting one in sectionTwo"\n    }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["A call to ",(0,l.jsx)(n.code,{children:"this.intlService.formatMessage('msg#sectionOne.greeting2')"})," would return ",(0,l.jsx)(n.code,{children:"This is greeting two"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Messages use ICU Message syntax that supports displaying variable values (strings, numbers and dates) and handles\npluralization rules according to the current locale. A map of values can be passed as the second\nparameter to ",(0,l.jsx)(n.code,{children:"IntlService.formatMessage"}),". For example, if ",(0,l.jsx)(n.code,{children:"message2"})," above were changed to ",(0,l.jsx)(n.code,{children:"Hello {name}"})," and then\nformatted by calling ",(0,l.jsx)(n.code,{children:"this.intlService.formatMessage('msg#sectionOne.greeting2', {name: 'Tom'});"})," the result would\nbe ",(0,l.jsx)(n.code,{children:"Hello Tom"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["For more information on the ICU Message syntax please follow this ",(0,l.jsx)(n.a,{href:"https://formatjs.io/guides/message-syntax/",children:"link"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"sqMessage"})," pipe is provided to facilitate the formatting of messages in component templates. Internally, it calls\n",(0,l.jsx)(n.code,{children:"IntlService.formatMessage"})," but also handles changes to the current locale, allowing any text displayed through the\npipe to be refreshed automatically. The above example could be rendered in a template as follows:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-html",children:"<span>{% raw %}{{'#msgsectionOne.greeting2' | sqMessage:{values: {name: 'Tom'} } }}{% endraw %}</span>\n"})}),"\n",(0,l.jsx)(n.p,{children:"Note the use of spaces between the closing curly brackets in the parameter passed to the pipe. Without these spaces they\nwould be interpreted as the termination of the interpolated value by the Angular template parser and an error would occur."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>i});var l=s(96540);const a={},t=l.createContext(a);function o(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);