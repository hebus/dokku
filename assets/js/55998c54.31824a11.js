"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2091],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=i.createContext({}),u=function(e){var t=i.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=u(e.components);return i.createElement(o.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,h=p["".concat(o,".").concat(m)]||p[m]||d[m]||a;return n?i.createElement(h,s(s({ref:t},c),{},{components:n})):i.createElement(h,s({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=m;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[p]="string"==typeof e?e:r,s[1]=l;for(var u=2;u<a;u++)s[u]=n[u];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},30333:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var i=n(87462),r=(n(67294),n(3905));const a={layout:"default",title:"Web Services Module",parent:"Core",grand_parent:"Libraries",nav_order:4},s="Web Services Module",l={unversionedId:"libraries/core/web-services",id:"libraries/core/web-services",title:"Web Services Module",description:"Initialization",source:"@site/docs/libraries/core/web-services.md",sourceDirName:"libraries/core",slug:"/libraries/core/web-services",permalink:"/dokku/docs/libraries/core/web-services",draft:!1,editUrl:"https://github.com/hebus/dokku/tree/main/docs/libraries/core/web-services.md",tags:[],version:"current",frontMatter:{layout:"default",title:"Web Services Module",parent:"Core",grand_parent:"Libraries",nav_order:4},sidebar:"tutorialSidebar",previous:{title:"Notification Module",permalink:"/dokku/docs/libraries/core/notification"},next:{title:"Components",permalink:"/dokku/docs/libraries/components/"}},o={},u=[{value:"Initialization",id:"initialization",level:2},{value:"App Web Service",id:"app-web-service",level:2},{value:"Principal Web Service",id:"principal-web-service",level:2},{value:"User Settings Web Service",id:"user-settings-web-service",level:2},{value:"Query Web Service",id:"query-web-service",level:2},{value:"Preview Web Service",id:"preview-web-service",level:2},{value:"Suggest Query Web Service",id:"suggest-query-web-service",level:2},{value:"Suggest Field Web Service",id:"suggest-field-web-service",level:2},{value:"Sponsored Links Web Service",id:"sponsored-links-web-service",level:2},{value:"Similar Documents Web Service",id:"similar-documents-web-service",level:2},{value:"Labels Web Service",id:"labels-web-service",level:2},{value:"Query Export Web Service / Download Web Service",id:"query-export-web-service--download-web-service",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"web-services-module"},"Web Services Module"),(0,r.kt)("h2",{id:"initialization"},"Initialization"),(0,r.kt)("p",null,"This module contains Angular services for the Sinequa web service APIs. The module can be initialized using the ",(0,r.kt)("inlineCode",{parentName:"p"},"WebServicesModule.forRoot")," static method in your applications's ",(0,r.kt)("inlineCode",{parentName:"p"},"NgModule")," which makes an injectable ",(0,r.kt)("inlineCode",{parentName:"p"},"StartConfig")," object available to the services and components across the application. At a minimum the object\npassed to forRoot should contain the ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"url")," (for ng serve or CORS support) fields. Other fields such as ",(0,r.kt)("inlineCode",{parentName:"p"},"apiPath"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"browserUrl")," will be initialized\nautomatically."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"@NgModule({\n    imports: [\n        ...\n        WebServicesModule.forRoot({\n            app: 'app-name',\n            url: 'http://localhost', // set for ng serve / CORS\n            production: environment.production\n        });\n    ]\n    ...\n});\n")),(0,r.kt)("p",null,"Services in this module use ",(0,r.kt)("inlineCode",{parentName:"p"},"SqHttpClient")," which derives from Angular's ",(0,r.kt)("inlineCode",{parentName:"p"},"HttpClient")," and does two things:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pipes the returned observable through the ",(0,r.kt)("inlineCode",{parentName:"li"},"share")," operator so that only one request is issued for multiple subscribers"),(0,r.kt)("li",{parentName:"ul"},"prevents ",(0,r.kt)("em",{parentName:"li"},"identical")," concurrent requests by caching pending responses")),(0,r.kt)("p",null,"Authentication is typically performed by the ",(0,r.kt)("a",{parentName:"p",href:"/dokku/docs/libraries/core/login"},"Login Module")," which provides an Angular ",(0,r.kt)("inlineCode",{parentName:"p"},"HttpInterceptor")," to handle ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP 401")," errors and\nautomatically initiate the authentication process with the Sinequa server."),(0,r.kt)("p",null,"Information on the usage of the various services follows:"),(0,r.kt)("h2",{id:"app-web-service"},"App Web Service"),(0,r.kt)("p",null,"Retrieves the ",(0,r.kt)("inlineCode",{parentName:"p"},"CCApp")," configuration object from the Sinequa server. The application name is taken from the injected ",(0,r.kt)("inlineCode",{parentName:"p"},"StartConfig"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    this.appWebService.get().subscribe(\n        (app) => {\n            console.log('app:', app);\n        }\n    );\n")),(0,r.kt)("h2",{id:"principal-web-service"},"Principal Web Service"),(0,r.kt)("p",null,"This service retrieves the ",(0,r.kt)("inlineCode",{parentName:"p"},"Principal")," object associated with the authenticated user. Although a basic ",(0,r.kt)("inlineCode",{parentName:"p"},"get")," method exists it is more usual to call\n",(0,r.kt)("inlineCode",{parentName:"p"},"load")," which gets the principal and sets it on the ",(0,r.kt)("inlineCode",{parentName:"p"},"principal")," property."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    this.principalWebService.load().subscribe(\n        (principal) => {\n            console.log('principal:', principal);\n        }\n    );\n")),(0,r.kt)("p",null,"The service also has an events property which can be subscribed to. A ",(0,r.kt)("inlineCode",{parentName:"p"},"changed")," event is emitted each time the ",(0,r.kt)("inlineCode",{parentName:"p"},"principal")," property changes."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    this.principalWebService.events.subscribe(\n        (event) => {\n            console.log('principal changed:', this.principalWebService.principal);\n        }\n    );\n")),(0,r.kt)("h2",{id:"user-settings-web-service"},"User Settings Web Service"),(0,r.kt)("p",null,"This service can load and save user settings associated with the authenticated user. The user settings are stored as JSON on the Sinequa\nserver. The ",(0,r.kt)("inlineCode",{parentName:"p"},"load")," method stores the loaded user settings in the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSettings")," property. The ",(0,r.kt)("inlineCode",{parentName:"p"},"UserSettings")," interface is declared\nwith an index signature to allow arbitrary values to be stored in it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    this.userSettingsService.load().subscribe(\n        (userSettings) => {\n            console.log('user settings:', userSettings);\n        }\n    );\n")),(0,r.kt)("p",null,"The current user settings can be modified on the client by updating the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSettings")," property and then calling ",(0,r.kt)("inlineCode",{parentName:"p"},"save"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    this.userSettingsService.userSettings.myProperty = 123;\n    this.userSettingsService.userSettings.save();\n")),(0,r.kt)("p",null,"The entire user settings are uploaded each time ",(0,r.kt)("inlineCode",{parentName:"p"},"save")," is called. To update only a subset of the user settings the ",(0,r.kt)("inlineCode",{parentName:"p"},"patch")," method can\nbe used. This performs a JSON merge patch (rfc7396) of the passed partial user settings object with the current user settings on the server.\nAdditions and updates can be performed like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'    // Add/update data in the user settings\n    if (!this.userSettingsService.userSettings) {\n        this.userSettingsService.userSettings = {};\n    }\n    const details = {\n        job: "Sales",\n        region: "US"\n    };\n    // Update locally\n    this.userSettingsService.userSettings.details = details;\n    // Update the server, sending only the details object\n    this.userSettingsService.patch({details});\n')),(0,r.kt)("p",null,"To remove data from the user settings set a null value:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    if (this.userSettingsService.userSettings) {\n        // Update locally\n        delete this.userSettingsService.userSettings.details;\n        // Update the server, sending an instruction to remove the `details` value from the user settings\n        this.userSettingsService.patch({details: null});\n    }\n")),(0,r.kt)("p",null,"The service also has an events property which can be subscribed to. A ",(0,r.kt)("inlineCode",{parentName:"p"},"changed")," event is emitted each time the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSettings")," property changes."),(0,r.kt)("h2",{id:"query-web-service"},"Query Web Service"),(0,r.kt)("p",null,"The query web service issues a Sinequa search ",(0,r.kt)("inlineCode",{parentName:"p"},"Query")," and retrieves an observable of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Results"),". The query name used must correspond one of the\nqueries configured on the application in the Sinequa administration."),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/dokku/docs/libraries/core/app-utils#query"},"documentation of the query object"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    const query = new Query('my-query-name');\n    query.text = 'football';\n    this.queryWebService.getResults(query).subscribe(\n        (results) => {\n            console.log('results:', results);\n        }\n    );\n\n")),(0,r.kt)("h2",{id:"preview-web-service"},"Preview Web Service"),(0,r.kt)("p",null,"This service retrieves data related to the document preview feature including highlighting information and the url to the preview document in the Sinequa document\ncache. The identifier of a document and the query context for highlighting are passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"get")," call:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    ...\n    this.previewWebService.get(docid, query).subscribe(\n        (previewData) => {\n            console.log('preview data:', previewData);\n        }\n    );\n")),(0,r.kt)("h2",{id:"suggest-query-web-service"},"Suggest Query Web Service"),(0,r.kt)("p",null,"This service gets suggestions for some input text using a ",(0,r.kt)("inlineCode",{parentName:"p"},"Suggest Query")," defined in the Sinequa administration console. The name of the current ",(0,r.kt)("inlineCode",{parentName:"p"},"Query"),"\nmust be passed and suggestions can optionally be limited to values from a set of passed fields. This service would typically be used by an autocomplete\ncomponent."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Get suggestions based on the input text for the authors column\n    this.suggestQueryWebService.get('my-suggest-query', 'input-text', query.name, ['authors']).subscribe(\n        (suggestions) => {\n            console.log('suggestions:', suggestions);\n        }\n    );\n")),(0,r.kt)("h2",{id:"suggest-field-web-service"},"Suggest Field Web Service"),(0,r.kt)("p",null,"This service gets suggestions for input text from the values found in the passed input fields in the Sinequa indexes. A ",(0,r.kt)("inlineCode",{parentName:"p"},"Query")," can be passed to limit\nsuggestions to values in the context of a query."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Get field value suggestions based on the input text for the authors column in the context of the passed `query`\n    this.suggestFieldWebService.get('input-text', ['authors'], query).subscribe(\n        (suggestions) => {\n            console.log('suggestions:', suggestions);\n        }\n    );\n")),(0,r.kt)("h2",{id:"sponsored-links-web-service"},"Sponsored Links Web Service"),(0,r.kt)("p",null,"This service retrieves any sponsored links configured on the Sinequa server that match the passed query context. The name of a sponsored links\nweb service configuration on the Sinequa server must also be passed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    this.sponsoredLinksWebService.getLinks(query, '_sponsoredlinks').subscribe(\n        (links) => {\n            console.log('sponsored links:', links);\n        }\n    );\n")),(0,r.kt)("h2",{id:"similar-documents-web-service"},"Similar Documents Web Service"),(0,r.kt)("p",null,"This service retrieves documents similar to the document with the passed id. It uses Sinequa's semantic vectors to return the documents closest\nto the passed document in the semantic space."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    this.similarDocumentsWebService.get(\"docid\", query.name).subscribe(\n        (records) => {\n            console.log('similar documents:', records);\n        }\n    );\n")),(0,r.kt)("h2",{id:"labels-web-service"},"Labels Web Service"),(0,r.kt)("p",null,"This service provides facilities for working with Sinequa's document tagging functionality. Labels are associated with documents and can be either\npublic (viewable by all users) or private (viewable only by the authenticated user). Labels matching a prefix can be retrieved using the ",(0,r.kt)("inlineCode",{parentName:"p"},"list")," method.\nThis could be used to provide an autocomplete component for labels."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Retrieve public labels matching the 'foo' prefix\n    this.labelsWebService.list('foo', true).subscribe(\n        (labels) => {\n            console.log('labels matching foo:', labels);\n        }\n    );\n")),(0,r.kt)("p",null,"One or more labels can added to one or more documents using the ",(0,r.kt)("inlineCode",{parentName:"p"},"add")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Add a private 'my-label' to documents with ids 'docid1' and 'docid2'\n    this.labelsWebService.add(['my-label'], ['docid1', 'docid2'], false);\n")),(0,r.kt)("p",null,"Similarly, labels can be removed using the ",(0,r.kt)("inlineCode",{parentName:"p"},"remove")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Remove a private 'my-label' from documents with ids 'docid1' and 'docid2'\n    this.labelsWebService.remove(['my-label'], ['docid1', 'docid2'], false);\n")),(0,r.kt)("p",null,"Labels can be renamed in all documents using the ",(0,r.kt)("inlineCode",{parentName:"p"},"rename")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Rename the public 'a-label' to 'new-label'\n    this.labelsWebService.rename(['a-label'], 'new-label', true);\n")),(0,r.kt)("p",null,"Labels can be deleted from all documents using the ",(0,r.kt)("inlineCode",{parentName:"p"},"delete")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Delete the private 'my-label'\n    this.labelsWebService.delete(['my-label'], false);\n")),(0,r.kt)("p",null,"Labels can be added and removed in bulk for a set of documents identified by a passed query. The\nnumber of matching documents is limited by a parameter configurable in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Labels")," web service\nin the Sinequa administration console."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Add the public 'a-label' label to the documents returned by executing `query`\n    this.labelsWebService.bulkAdd(['a-label'], query, true);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    // Remove the public 'a-label' label from the documents returned by executing `query`\n    this.labelsWebService.bulkRemove(['a-label'], query, true);\n")),(0,r.kt)("h2",{id:"query-export-web-service--download-web-service"},"Query Export Web Service / Download Web Service"),(0,r.kt)("p",null,"The Query Export Web Service provides methods for exporting the results of Sinequa search queries in a variety of formats.\nThe number of documents exported is limited by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Maximum number of results by index")," setting on the associated\n",(0,r.kt)("inlineCode",{parentName:"p"},"Query")," in the Sinequa administration console. The output of the Query Export Web Service can be passed to the Download Web\nService to save the results to disk. There are methods for exporting all the results (",(0,r.kt)("inlineCode",{parentName:"p"},"exportResult"),"), a selection of the\nresults (",(0,r.kt)("inlineCode",{parentName:"p"},"exportSelection"),") and the results of executing a saved query (",(0,r.kt)("inlineCode",{parentName:"p"},"exportSavedQuery"),")."),(0,r.kt)("p",null,"Export the results of a query in CSV format and have the browser download the output to a file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"    this.downloadWebService.download(\n        this.queryExportWebService.exportResult('web-service-name', query, results,\n            ExportOutputFormat.Csv));\n")))}d.isMDXComponent=!0}}]);